// src/app/features/mybuddy/mybuddy.ts

ngOnInit(): void {
  // 1. Capture the Redirect Data IMMEDIATELY
  const state = history.state as { autoPrompt?: string };
  
  this.restoreSidebarHistory();

  // 2. Load History First
  this.loadActiveThread(() => {
    
    // 3. CHECK: Did we come from a redirect?
    if (state && state.autoPrompt) {
      console.log('ðŸš€ Redirect detected:', state.autoPrompt);

      // âœ… FIX: Use setTimeout to wait for the History to render
      setTimeout(() => {
        // A. Set the text in the box
        this.queryControl.setValue(state.autoPrompt);

        // B. "Click Enter"
        this.submitQuery();
      }, 50); // 50ms delay is enough to separate the updates
    }
  });

  setTimeout(() => this.isInitializing.set(false), 1500);
  this.startHelperRotation();
  
  // URL Query Params Logic...
  this.route.queryParams.subscribe(params => { /* ... */ });
}
