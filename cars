CREATE TABLE ICMP_RULE
(
    RULE_ID INT IDENTITY(1,1) PRIMARY KEY,

    DEPARTMENT_CODE VARCHAR(50) NOT NULL,

    -- DOCUMENT | RELATIONSHIP
    TARGET_TYPE VARCHAR(20) NOT NULL,

    -- EMP_ENTY, DEAL (NULL for document rules)
    TARGET_OBJECT_TYPE VARCHAR(50) NULL,

    PROPERTY_KEY VARCHAR(100) NOT NULL,

    -- FIELD | STATIC
    SOURCE_TYPE VARCHAR(20) NOT NULL,

    SOURCE_VALUE VARCHAR(200) NOT NULL,

    -- JSON representation of List<RuleCondition>
    CONDITIONS_JSON NVARCHAR(MAX) NULL,

    SORT_ORDER INT NOT NULL,

    IS_ACTIVE BIT NOT NULL DEFAULT 1,

    CREATED_BY VARCHAR(50) NOT NULL DEFAULT 'SYSTEM',
    CREATED_ON DATETIME NOT NULL DEFAULT GETUTCDATE()
);


INSERT INTO ICMP_RULE
(DEPARTMENT_CODE, TARGET_TYPE, PROPERTY_KEY, SOURCE_TYPE, SOURCE_VALUE, CONDITIONS_JSON, SORT_ORDER)
VALUES
(
 'CRH',
 'DOCUMENT',
 'DOC_EFFE_DTTM',
 'FIELD',
 'EffectiveDate',
 '[{"Field":"EffectiveDate","Operator":"IsNotNull"}]',
 10
),
(
 'CRHI',
 'DOCUMENT',
 'DOC_EFFE_DTTM',
 'FIELD',
 'EffectiveDate',
 '[{"Field":"EffectiveDate","Operator":"IsNotNull"}]',
 10
);

INSERT INTO ICMP_RULE
(DEPARTMENT_CODE, TARGET_TYPE, PROPERTY_KEY, SOURCE_TYPE, SOURCE_VALUE, SORT_ORDER)
VALUES
('CRH',  'DOCUMENT', 'COUNTRY', 'FIELD', 'Country', 20),
('CRHI', 'DOCUMENT', 'COUNTRY', 'FIELD', 'Country', 20);


INSERT INTO ICMP_RULE
(DEPARTMENT_CODE, TARGET_TYPE, PROPERTY_KEY, SOURCE_TYPE, SOURCE_VALUE, SORT_ORDER)
VALUES
('CRH',  'DOCUMENT', 'REG_CNT_IND', 'FIELD', 'Regulated', 30),
('CRHI', 'DOCUMENT', 'REG_CNT_IND', 'FIELD', 'Regulated', 30);


INSERT INTO ICMP_RULE
(DEPARTMENT_CODE, TARGET_TYPE, TARGET_OBJECT_TYPE, PROPERTY_KEY,
 SOURCE_TYPE, SOURCE_VALUE, CONDITIONS_JSON, SORT_ORDER)
VALUES
(
 'CRH',
 'RELATIONSHIP',
 'EMP_ENTY',
 'EMP_ID',
 'FIELD',
 'EmployeeId',
 '[{"Field":"EmployeeId","Operator":"IsNotNull"}]',
 100
),
(
 'CRHI',
 'RELATIONSHIP',
 'EMP_ENTY',
 'EMP_ID',
 'FIELD',
 'EmployeeId',
 '[{"Field":"EmployeeId","Operator":"IsNotNull"}]',
 100
);

INSERT INTO ICMP_RULE
(DEPARTMENT_CODE, TARGET_TYPE, TARGET_OBJECT_TYPE, PROPERTY_KEY,
 SOURCE_TYPE, SOURCE_VALUE, SORT_ORDER)
VALUES
('CRH',  'RELATIONSHIP', 'EMP_ENTY', 'SOR_CD', 'STATIC', 'VSTAR', 110),
('CRHI', 'RELATIONSHIP', 'EMP_ENTY', 'SOR_CD', 'STATIC', 'VSTAR', 110);

INSERT INTO ICMP_RULE
(DEPARTMENT_CODE, TARGET_TYPE, TARGET_OBJECT_TYPE, PROPERTY_KEY,
 SOURCE_TYPE, SOURCE_VALUE, CONDITIONS_JSON, SORT_ORDER)
VALUES
(
 'CRHI',
 'RELATIONSHIP',
 'DEAL',
 'ENTR_DEAL_ID',
 'FIELD',
 'CisiveCaseId',
 '[{"Field":"CisiveCaseId","Operator":"IsNotNull"}]',
 200
);


INSERT INTO ICMP_RULE
(DEPARTMENT_CODE, TARGET_TYPE, TARGET_OBJECT_TYPE, PROPERTY_KEY,
 SOURCE_TYPE, SOURCE_VALUE, CONDITIONS_JSON, SORT_ORDER)
VALUES
(
 'CRHI',
 'RELATIONSHIP',
 'DEAL',
 'SOR_CD',
 'STATIC',
 'CRC22',
 '[{"Field":"Country","Operator":"Equals","Values":["USA"]}]',
 210
);
 
